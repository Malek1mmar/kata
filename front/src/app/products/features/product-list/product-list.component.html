<div class="flex justify-content-between align-items-center mb-5 mt-4 px-3">
  <h1 class="m-0">Liste des produits</h1>

  <span class="p-input-icon-left w-full md:w-20rem">
        <i class="pi pi-search"></i>
        <input pInputText
               type="text"
               (input)="dv.filter($any($event.target).value)"
               placeholder="Rechercher un produit..."
               class="w-full shadow-1" />
    </span>
</div>

<p-button label="Créer produit" (onClick)="onCreate()" class="block text-center"/>

<p-dataView #dv [value]="products()" [paginator]="true" [rows]="5" filterBy="name,category">
  <ng-template pTemplate="list" let-products>
    <div class="grid p-2">
      @for (product of products; track product.id) {
        <div class="col-12 md:col-4">
            <p-card class="block mb-2">
                <div class="flex justify-content-between">
                    <span class="font-medium text-secondary text-sm">{{ product.category }}</span>
                    <p-tag [value]="product.inventoryStatus" [severity]="getSeverity(product)"></p-tag>
                    </div>

                    <div class="text-lg font-medium text-900 mt-2">{{ product.name }}</div>
                    <div class="text-xl font-bold mt-1">{{ product.price }} €</div>

                    <ng-template pTemplate="footer">
                        <div class="flex gap-2">
                            <p-button label="Détails"
                                      severity="secondary"
                                      icon="pi pi-info-circle"
                                      (onClick)="onShowDetails(product)" />
                            <p-button label="Ajouter" icon="pi pi-shopping-cart"
                                      [disabled]="product.inventoryStatus === 'OUTOFSTOCK'"
                                      (onClick)="cartService.addToCart(product)" />
                        </div>
                    </ng-template>
            </p-card>
        </div>
      }
    </div>
  </ng-template>
</p-dataView>

<p-dialog [(visible)]="isDialogVisible"
    [style]="{ width: '50vw' }"
    header="Ajout/Edition produit">
    <app-product-form
        [product]="editedProduct()"
        (save)="onSave($event)"
        (cancel)="onCancel()"
    />
</p-dialog>



<p-dialog [(visible)]="isDetailsVisible" [header]="selectedProduct?.name" [modal]="true" [style]="{width: '400px'}">
  <div *ngIf="selectedProduct" class="text-center">
    <p class="text-left"><strong>Description:</strong> {{selectedProduct.description}}</p>
    <p class="text-left"><strong>Référence:</strong> {{selectedProduct.internalReference}}</p>
    <p class="text-left"><strong>Note:</strong> {{selectedProduct.rating}} / 5 ⭐</p>
  </div>
</p-dialog>
